<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Secret Bunutan</title>
<style>
  body {
    font-family: Poppins, Arial, sans-serif;
    background: #f8f9fd;
    color: #222;
    text-align: center;
    padding: 40px;
  }
  h1 { color: #333; }
  button {
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 8px;
    background: #4CAF50;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }
  #drawn, #msg {
    margin-top: 20px;
    font-size: 20px;
  }
</style>
</head>
<body>

<h1>üéÅ Secret Bunutan</h1>

<div id="drawSection">
  <p id="msg"></p>
  <button id="drawBtn">Draw Your Bunot üé≤</button>
  <div id="drawn"></div>
</div>

<script>
// === FIXED GLOBAL LIST ===
const allNames = [
  "Jannette","Haydee","Avegail","Jassen","Reigne","Reigen",
  "Reigven","Reigson","Sanja","Simone","Clem","Kevin","Crispin"
];

// === Load storage for drawn results (shared per browser) ===
let assigned = JSON.parse(localStorage.getItem("bunutan_assigned") || "{}");
const params = new URLSearchParams(window.location.search);
let currentUser = params.get("user");

// === Validation (case-insensitive) ===
if (!currentUser) {
  document.body.innerHTML = "<h2>‚ö†Ô∏è Missing participant link.</h2>";
  throw new Error("Missing user");
}

currentUser = currentUser.trim();

// find match ignoring capitalization
const match = allNames.find(n => n.toLowerCase() === currentUser.toLowerCase());
if (!match) {
  document.body.innerHTML = "<h2>‚ö†Ô∏è Invalid participant link.</h2>";
  throw new Error("Invalid user");
}
currentUser = match;

// === Display welcome message ===
document.getElementById("msg").innerHTML = `<b>Welcome, ${currentUser}!</b><br>Click below to reveal your bunot üéÅ`;

document.getElementById("drawBtn").onclick = () => {
  // get already drawn names
  let used = Object.values(assigned);

  // exclude self + already used
  let available = allNames.filter(n => !used.includes(n) && n !== currentUser);

  if (assigned[currentUser]) {
    document.getElementById("drawn").innerHTML = `üéâ You already got: <b>${assigned[currentUser]}</b>`;
    document.getElementById("drawBtn").disabled = true;
    return;
  }

  if (!available.length) {
    document.getElementById("drawn").innerHTML = "‚ö†Ô∏è No more names left!";
    document.getElementById("drawBtn").disabled = true;
    return;
  }

  // random draw
  const rand = Math.floor(Math.random() * available.length);
  const chosen = available[rand];

  // assign and save
  assigned[currentUser] = chosen;
  localStorage.setItem("bunutan_assigned", JSON.stringify(assigned));

  document.getElementById("drawn").innerHTML = `üéâ You got: <b>${chosen}</b>`;
  document.getElementById("drawBtn").disabled = true;
};
</script>

</body>
</html>
