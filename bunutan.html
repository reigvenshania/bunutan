<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Secret Bunutan üéÅ</title>
<style>
  body {
    font-family: Poppins, Arial, sans-serif;
    background: #f8f9fd;
    color: #222;
    text-align: center;
    padding: 40px;
  }
  h1 { color: #333; margin-bottom: 10px; }
  button {
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 8px;
    background: #4CAF50;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  #drawn, #msg {
    margin-top: 20px;
    font-size: 20px;
  }
  .links {
    margin-top: 40px;
    font-size: 16px;
  }
  a {
    color: #007bff;
    text-decoration: none;
  }
  a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>üéÅ Secret Bunutan</h1>
<p id="msg"></p>
<button id="drawBtn">Draw Your Bunot üé≤</button>
<div id="drawn"></div>

<div class="links" id="links"></div>

<script>
const allNames = [
  "Jannette","Haydee","Avegail","Jassen","Reigne","Reigen",
  "Reigven","Reigson","Sanja","Simone","Clem","Kevin", "Crispin"
];

let assigned = JSON.parse(localStorage.getItem("bunutan_assigned") || "{}");
const params = new URLSearchParams(window.location.search);
let currentUser = params.get("user");

// === Auto-generate participant links if no ?user= ===
if (!currentUser) {
  document.getElementById("msg").innerHTML = "<b>Click your name below to join:</b>";
  let html = "<ul style='list-style:none;padding:0;'>";
  allNames.forEach(name => {
    html += `<li><a href="?user=${encodeURIComponent(name)}">${name}</a></li>`;
  });
  html += "</ul>";
  document.getElementById("links").innerHTML = html;
  document.getElementById("drawBtn").style.display = "none";
  return;
}

currentUser = currentUser.trim();
const match = allNames.find(n => n.toLowerCase() === currentUser.toLowerCase());
if (!match) {
  document.body.innerHTML = "<h2>‚ö†Ô∏è Invalid participant link.</h2>";
  throw new Error("Invalid user");
}
currentUser = match;

document.getElementById("msg").innerHTML = `<b>Welcome, ${currentUser}!</b><br>Click below to reveal your bunot üéÅ`;

document.getElementById("drawBtn").onclick = () => {
  let used = Object.values(assigned);
  let available = allNames.filter(n => !used.includes(n) && n !== currentUser);

  if (assigned[currentUser]) {
    document.getElementById("drawn").innerHTML = `üéâ You already got: <b>${assigned[currentUser]}</b>`;
    document.getElementById("drawBtn").disabled = true;
    return;
  }

  if (!available.length) {
    document.getElementById("drawn").innerHTML = "‚ö†Ô∏è No more names left!";
    document.getElementById("drawBtn").disabled = true;
    return;
  }

  const rand = Math.floor(Math.random() * available.length);
  const chosen = available[rand];
  assigned[currentUser] = chosen;
  localStorage.setItem("bunutan_assigned", JSON.stringify(assigned));

  document.getElementById("drawn").innerHTML = `üéâ You got: <b>${chosen}</b>`;
  document.getElementById("drawBtn").disabled = true;
};
</script>

</body>
</html>
