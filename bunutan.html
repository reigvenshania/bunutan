<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Online Bunutan</title>
<style>
  body{font-family:Poppins,Arial,sans-serif;background:#f8f9fd;color:#222;text-align:center;padding:40px;}
  h1{color:#333;}
  textarea{width:80%;height:100px;padding:10px;border-radius:8px;border:1px solid #ccc;}
  button{padding:10px 20px;margin:10px;border:none;border-radius:8px;background:#4CAF50;color:white;font-size:16px;cursor:pointer;}
  #drawn,#msg{margin-top:20px;font-size:20px;}
  #remaining{margin-top:10px;color:#666;}
</style>
</head>
<body>

<h1>üéÅ Secret Bunutan</h1>

<div id="setup">
  <p>Enter all participant names (comma separated):</p>
  <textarea id="nameList">Jannette, Haydee, Avegail, Jassen, Reigne, Reigen, Reigven, Reigson, Sanja, Simone, Clem, Kevin</textarea><br>
  <button id="generateLinks">Generate Links</button>
  <div id="links"></div>
</div>

<div id="drawSection" style="display:none;">
  <p id="msg"></p>
  <button id="drawBtn">Draw Your Bunot üé≤</button>
  <div id="drawn"></div>
</div>

<script>
let allNames = [];
let assigned = JSON.parse(localStorage.getItem("bunutan_assigned") || "{}");
const params = new URLSearchParams(window.location.search);
const currentUser = params.get("user");
const setup = document.getElementById("setup");
const drawSection = document.getElementById("drawSection");

// === ORGANIZER MODE ===
if (!currentUser) {
  setup.style.display = "block";
  drawSection.style.display = "none";
  document.getElementById("generateLinks").onclick = () => {
    const names = document.getElementById("nameList").value.split(",").map(n=>n.trim()).filter(n=>n);
    if (names.length < 2) return alert("Please enter at least 2 names!");
    allNames = names;
    localStorage.setItem("bunutan_names", JSON.stringify(allNames));
    localStorage.setItem("bunutan_assigned", "{}"); // reset previous draws

    const base = window.location.href.split("?")[0];
    let html = "<h3>Share these links:</h3>";
    names.forEach(n=>{
      const url = `${base}?user=${encodeURIComponent(n)}`;
      html += `<div><a href="${url}" target="_blank">${n}'s Link</a></div>`;
    });
    document.getElementById("links").innerHTML = html;
  };
}

// === PARTICIPANT MODE ===
else {
  setup.style.display = "none";
  drawSection.style.display = "block";
  document.getElementById("msg").innerHTML = `<b>Welcome, ${currentUser}!</b><br>Click below to reveal your bunot üéÅ`;

  document.getElementById("drawBtn").onclick = () => {
    const all = JSON.parse(localStorage.getItem("bunutan_names") || "[]");
    if (!all.length) return alert("Organizer hasn‚Äôt set up the names yet!");

    // get all used names
    let assignedList = JSON.parse(localStorage.getItem("bunutan_assigned") || "{}");
    let used = Object.values(assignedList);

    // available names exclude those already drawn AND yourself
    let available = all.filter(n => !used.includes(n) && n !== currentUser);

    if (assignedList[currentUser]) {
      document.getElementById("drawn").innerHTML = `üéâ You already got: <b>${assignedList[currentUser]}</b>`;
      return;
    }
    if (!available.length) {
      document.getElementById("drawn").innerHTML = "‚ö†Ô∏è No more names left!";
      return;
    }

    // random draw
    const rand = Math.floor(Math.random() * available.length);
    const chosen = available[rand];

    assignedList[currentUser] = chosen;
    localStorage.setItem("bunutan_assigned", JSON.stringify(assignedList));

    document.getElementById("drawn").innerHTML = `üéâ You got: <b>${chosen}</b>`;
    document.getElementById("drawBtn").disabled = true;
  };
}
</script>

</body>
</html>
